<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Painel Gestor Digital — Harmonia no Casamento e na Adoração</title>
    <!-- Tailwind Play CDN (para protótipo) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM + Babel (prototipagem no browser) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-slate-50">
    <div id="root"></div>

    <!-- App (JSX compilado com Babel no browser — somente para protótipo) -->
    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      // --- Helpers ---
      const uid = () => Math.random().toString(36).slice(2, 9);
      const readStorage = (k, fallback) => { try { const r = localStorage.getItem(k); return r ? JSON.parse(r) : fallback; } catch (e) { return fallback; } };
      const writeStorage = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch (e) { } };
      const formatCurrencyLocal = (v) => { try { const n = Number(v) || 0; return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); } catch (e) { return 'R$ 0,00'; } };

      function defaultSettings(){
        return {
          youtubeChannels: [
            { name: 'Harmonia no Casamento', subscribers: 1200, lastVideo: null },
          ],
        };
      }
      function emptyForm(){ return { date: new Date().toISOString().slice(0,10), platform: 'Hotmart', product: '', niche: '', value: 0, status: 'Pago' }; }

      // --- Core component ---
      function PainelGestorDigital(){
        const [sales, setSales] = useState(() => readStorage('gs_sales_v2', []));
        const [settings, setSettings] = useState(() => readStorage('gs_settings_v2', defaultSettings()));
        const [ui, setUi] = useState({ filterRange: 'month', showModal: false, editing: null });
        const [form, setForm] = useState(emptyForm());

        useEffect(() => writeStorage('gs_sales_v2', sales), [sales]);
        useEffect(() => writeStorage('gs_settings_v2', settings), [settings]);

        const filteredSales = useMemo(()=> filterByRange(sales, ui.filterRange), [sales, ui.filterRange]);
        const totals = useMemo(()=> computeTotals(filteredSales), [filteredSales]);
        const platformSummary = useMemo(()=> summarizeBy(filteredSales, 'platform'), [filteredSales]);
        const nicheSummary = useMemo(()=> summarizeBy(filteredSales, 'niche'), [filteredSales]);
        const youtubeSummary = useMemo(()=> summarizeYoutube(settings.youtubeChannels, sales), [settings.youtubeChannels, sales]);

        function openAdd(){ setUi(u => ({...u, showModal: true, editing: null})); setForm(emptyForm()); }
        function openEdit(s){ setUi(u => ({...u, showModal: true, editing: s.id})); setForm({...s}); }
        function save(e){ e && e.preventDefault(); const payload = {...form, id: ui.editing || uid()}; if (ui.editing) setSales(s => s.map(x => x.id === ui.editing ? payload : x)); else setSales(s => [payload, ...s]); setUi(u => ({...u, showModal: false, editing: null})); }
        function remove(id){ if (!confirm('Remover registro?')) return; setSales(s => s.filter(x => x.id !== id)); }

        return (
          <div className="min-h-screen">
            <div className="max-w-7xl mx-auto grid grid-cols-12 gap-6 p-6">
              <aside className="col-span-12 lg:col-span-2 bg-white rounded-2xl shadow p-4 h-fit sticky top-6">
                <div className="flex items-center gap-3 mb-4">
                  <div className="w-10 h-10 bg-gradient-to-br from-indigo-500 to-violet-500 rounded flex items-center justify-center text-white font-bold">GS</div>
                  <div>
                    <div className="text-sm font-semibold">Seu Nome Aqui</div>
                    <div className="text-xs text-gray-500">Gestor de Negócios Digitais</div>
                  </div>
                </div>
                <nav className="space-y-2 text-sm">
                  <SectionLink label="Visão Geral" active />
                  <SectionLink label="Vendas" />
                  <SectionLink label="Plataformas" />
                  <SectionLink label="Funis" />
                  <SectionLink label="YouTube & Canais" />
                  <SectionLink label="Freelancers" />
                  <SectionLink label="Configurações" />
                </nav>
                <div className="border-t mt-4 pt-4 text-xs text-gray-500">
                  <div className="font-semibold">Serviços</div>
                  <ul className="mt-2 space-y-1">
                    <li>Criação de Páginas</li>
                    <li>Campanhas (ADS)</li>
                    <li>Scripts para Vendas</li>
                    <li>Automação (YouTube / Emails)</li>
                    <li>Design de Capa/Thumbnail</li>
                  </ul>
                </div>
              </aside>

              <main className="col-span-12 lg:col-span-10 space-y-6">
                <header className="flex items-center justify-between">
                  <div>
                    <h1 className="text-2xl font-bold">Painel: Harmonia no Casamento e na Adoração</h1>
                    <p className="text-sm text-gray-500">Informações essenciais para quem gerencia vendas, canais YouTube e serviços de freelancers.</p>
                  </div>
                  <div className="flex items-center gap-3">
                    <div className="text-right text-sm">
                      <div className="text-xs text-gray-400">Conta</div>
                      <div className="font-medium">gilfsantos1978@gmail.com</div>
                    </div>
                    <button onClick={openAdd} className="px-4 py-2 bg-indigo-600 text-white rounded-2xl">+ Novo Registro</button>
                  </div>
                </header>

                <section className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                  <MetricCard title="Receita (período)" value={totals.totalValue} subtitle={`${totals.count} vendas`} />
                  <MetricCard title="Ticket Médio" value={totals.count ? totals.totalValue / totals.count : 0} subtitle={`Base: ${totals.count} vendas`} />
                  <MetricCard title="Conversão (estimada)" value={estimateConversion(sales)} subtitle="Visitas → Vendas" />
                  <MetricCard title="YouTube: inscritos ativos" value={youtubeSummary.subscribers} subtitle={`${youtubeSummary.channels} canais`} />
                </section>

                <section className="grid grid-cols-1 lg:grid-cols-3 gap-4">
                  <div className="col-span-1 lg:col-span-2 space-y-4">
                    <div className="bg-white rounded-2xl p-4 shadow">
                      <div className="flex items-center justify-between mb-3">
                        <h3 className="font-semibold">Plataformas — resumo</h3>
                        <div className="text-sm text-gray-500">Agrupado por plataforma</div>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {Object.keys(platformSummary).length === 0 && <div className="text-sm text-gray-500 p-3">Sem dados — adicione registros</div>}
                        {Object.entries(platformSummary).map(([k,v])=> (
                          <div key={k} className="border rounded p-3 flex items-center justify-between">
                            <div>
                              <div className="font-medium">{k}</div>
                              <div className="text-xs text-gray-500">{v.count} vendas</div>
                            </div>
                            <div className="text-sm font-semibold">{formatCurrencyLocal(v.total)}</div>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="bg-white rounded-2xl p-4 shadow">
                      <h3 className="font-semibold mb-2">Funis de Venda (visão rápida)</h3>
                      <p className="text-xs text-gray-500 mb-3">Fluxos típicos: YouTube → Página de Vendas → Checkout → Pós-venda</p>
                      <FunnelDemo sales={sales} />
                    </div>

                    <div className="bg-white rounded-2xl p-4 shadow">
                      <h3 className="font-semibold mb-2">Nichos & Serviços</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {Object.keys(nicheSummary).length === 0 && <div className="text-sm text-gray-500 p-3">Sem dados de nicho ainda</div>}
                        {Object.entries(nicheSummary).map(([k,v])=> (
                          <div key={k} className="p-2 border rounded">
                            <div className="font-medium">{k}</div>
                            <div className="text-xs text-gray-500">{v.count} vendas • {formatCurrencyLocal(v.total)}</div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  <div className="space-y-4">
                    <div className="bg-white rounded-2xl p-4 shadow">
                      <h3 className="font-semibold mb-2">Tendência — últimos 14 dias</h3>
                      <MiniSparkline sales={sales} days={14} />
                      <div className="mt-3 text-xs text-gray-500">Visão rápida de receita diária</div>
                    </div>

                    <div className="bg-white rounded-2xl p-4 shadow">
                      <h3 className="font-semibold mb-2">Métricas detalhadas</h3>
                      <ul className="text-sm space-y-2">
                        <li>Vendas totais (período): <strong>{totals.count}</strong></li>
                        <li>Receita total (período): <strong>{formatCurrencyLocal(totals.totalValue)}</strong></li>
                        <li>Ticket médio: <strong>{formatCurrencyLocal(totals.count ? totals.totalValue / totals.count : 0)}</strong></li>
                      </ul>
                    </div>

                    <div className="bg-white rounded-2xl p-4 shadow">
                      <h3 className="font-semibold mb-2">YouTube & Freelancers</h3>
                      <div className="text-sm text-gray-600 mb-2">Canais monitorados</div>
                      <ul className="space-y-2">
                        {settings.youtubeChannels.map(c=> (
                          <li key={c.name} className="flex items-center justify-between">
                            <div>
                              <div className="font-medium">{c.name}</div>
                              <div className="text-xs text-gray-500">Último vídeo: {c.lastVideo || '—'}</div>
                            </div>
                            <div className="text-sm text-gray-700">{c.subscribers || '—'}</div>
                          </li>
                        ))}
                      </ul>
                      <div className="mt-3 border-t pt-3 text-sm">
                        <div className="font-medium">Freelancers ativos</div>
                        <div className="text-xs text-gray-500">Designers • Editores • Copywriters • Ads</div>
                      </div>
                    </div>
                  </div>
                </section>

                <section className="bg-white rounded-2xl p-4 shadow">
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="font-semibold">Registro de Vendas (tabela)</h3>
                    <div className="flex items-center gap-2">
                      <select value={ui.filterRange} onChange={(e)=> setUi(u => ({...u, filterRange: e.target.value}))} className="p-2 border rounded">
                        <option value="today">Hoje</option>
                        <option value="week">Semana</option>
                        <option value="fortnight">Quinzena</option>
                        <option value="month">Mês</option>
                        <option value="all">Todos</option>
                      </select>
                      <div className="text-sm text-gray-500">{filteredSales.length} registros</div>
                    </div>
                  </div>

                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="text-left text-gray-600 border-b"><tr><th className="py-2">Data</th><th>Plataforma</th><th>Produto / Serviço</th><th>Nicho</th><th>Valor</th><th>Status</th><th>Ações</th></tr></thead>
                      <tbody>
                        {filteredSales.length === 0 && (<tr><td colSpan={7} className="py-6 text-center text-gray-500">Nenhum registro. Clique em "+ Novo Registro".</td></tr>)}
                        {filteredSales.map(s => (
                          <tr key={s.id} className="border-b hover:bg-gray-50">
                            <td className="py-3">{new Date(s.date).toLocaleDateString()}</td>
                            <td>{s.platform}</td>
                            <td>{s.product}</td>
                            <td>{s.niche}</td>
                            <td>{formatCurrencyLocal(s.value)}</td>
                            <td>{s.status}</td>
                            <td>
                              <div className="flex gap-2">
                                <button className="px-2 py-1 rounded border text-xs" onClick={()=> openEdit(s)}>Editar</button>
                                <button className="px-2 py-1 rounded border text-xs" onClick={()=> remove(s.id)}>Remover</button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </section>

                <footer className="text-xs text-gray-500 mt-4">Protótipo salvo localmente no seu navegador (localStorage). Para produção, gerar backend (Node/SQLite) e autenticação.</footer>
              </main>
            </div>

            {ui.showModal && (
              <div className="fixed inset-0 bg-black/40 flex items-center justify-center p-4">
                <form onSubmit={save} className="w-full max-w-xl bg-white p-6 rounded-2xl shadow-lg">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="text-lg font-semibold">{ui.editing ? 'Editar Registro' : 'Novo Registro'}</h3>
                    <button type="button" onClick={() => setUi(u => ({...u, showModal: false}))} className="text-gray-500">Fechar</button>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <label className="flex flex-col"><span className="text-xs text-gray-600">Data</span><input required value={form.date} onChange={(e)=> setForm(f => ({...f, date: e.target.value}))} type="date" className="mt-1 p-2 border rounded" /></label>
                    <label className="flex flex-col"><span className="text-xs text-gray-600">Plataforma</span><input required value={form.platform} onChange={(e)=> setForm(f => ({...f, platform: e.target.value}))} className="mt-1 p-2 border rounded" /></label>
                    <label className="flex flex-col"><span className="text-xs text-gray-600">Produto / Serviço</span><input required value={form.product} onChange={(e)=> setForm(f => ({...f, product: e.target.value}))} placeholder="Nome do produto" className="mt-1 p-2 border rounded" /></label>
                    <label className="flex flex-col"><span className="text-xs text-gray-600">Nicho</span><input value={form.niche} onChange={(e)=> setForm(f => ({...f, niche: e.target.value}))} className="mt-1 p-2 border rounded" /></label>
                    <label className="flex flex-col"><span className="text-xs text-gray-600">Valor (R$)</span><input required value={form.value} onChange={(e)=> setForm(f => ({...f, value: e.target.value}))} type="number" step="0.01" className="mt-1 p-2 border rounded" /></label>
                    <label className="flex flex-col md:col-span-2"><span className="text-xs text-gray-600">Status</span><select value={form.status} onChange={(e)=> setForm(f => ({...f, status: e.target.value}))} className="mt-1 p-2 border rounded"><option>Pago</option><option>Parcela</option><option>Cancelado</option></select></label>
                  </div>

                  <div className="flex items-center justify-end gap-3 mt-4"><button type="button" onClick={()=> setUi(u => ({...u, showModal:false}))} className="px-3 py-1 border rounded">Cancelar</button><button type="submit" className="px-4 py-2 bg-green-600 text-white rounded">Salvar</button></div>
                </form>
              </div>
            )}

          </div>
        );
      }

      // --- Small components/helpers used in App ---
      function SectionLink({label, active}){ return (<div className={`px-2 py-1 rounded text-sm ${active ? 'bg-indigo-50 text-indigo-600' : 'text-gray-700'}`}>{label}</div>); }
      function MetricCard({title, value, subtitle}){ return (<div className="bg-white rounded-2xl p-4 shadow"><div className="text-xs text-gray-500">{title}</div><div className="text-xl font-bold">{formatCurrencyLocal(value)}</div><div className="text-sm text-gray-500">{subtitle}</div></div>); }

      function summarizeBy(list, key){ return list.reduce((acc, item)=>{ const k = item[key] || '—'; acc[k]=acc[k]||{count:0,total:0}; acc[k].count++; acc[k].total += Number(item.value||0); return acc; }, {}); }
      function computeTotals(list){ return list.reduce((acc, s)=> ({ count: acc.count+1, totalValue: acc.totalValue + Number(s.value||0) }), {count:0, totalValue:0}); }
      function filterByRange(list, range){ const now = new Date(); if(range==='all') return list; return list.filter(s=>{ if(!s.date) return false; const d = new Date(s.date); if(range==='today'){ return d.getFullYear()===now.getFullYear() && d.getMonth()===now.getMonth() && d.getDate()===now.getDate(); } if(range==='week'){ const diff=(now-d)/(1000*60*60*24); return diff<=7; } if(range==='fortnight'){ const diff=(now-d)/(1000*60*60*24); return diff<=15; } if(range==='month'){ const monthStart = new Date(now.getFullYear(), now.getMonth(),1); return d>=monthStart && d<=now; } return true; }); }
      function estimateConversion(list){ // placeholder: not accurate — apenas estimativa
        const visits = 1000; const sales = list.length||0; return sales ? `${((sales/visits)*100).toFixed(2)}%` : '0%';
      }
      function summarizeYoutube(channels, sales){ return { channels: channels.length, subscribers: channels.reduce((a,c)=> a + (Number(c.subscribers)||0),0) }; }

      function FunnelDemo({sales}){
        // simple static funnel visualization
        const steps = [ {label:'YouTube', v:1000},{label:'Página', v:320},{label:'Checkout', v:80},{label:'Compra', v: sales.length || 5} ];
        return (<div className="space-y-2">{steps.map((s,i)=> (<div key={i} className="flex items-center gap-3"><div className="w-28 text-xs">{s.label}</div><div className="flex-1 bg-gray-100 rounded h-4 relative"><div style={{width: `${Math.max(6,(s.v/steps[0].v)*100)}%`}} className="absolute left-0 top-0 bottom-0 bg-indigo-500 rounded"/></div><div className="w-12 text-xs text-right">{s.v}</div></div>))}</div>);
      }

      function MiniSparkline({sales, days=14}){
        const now = new Date(); const arr = Array.from({length:days}).map((_,i)=>{ const d=new Date(now); d.setDate(now.getDate()-(days-1-i)); const key = d.toISOString().slice(0,10); const sum = sales.filter(s=> s.date && s.date.slice(0,10)===key).reduce((a,b)=> a + Number(b.value||0), 0); return {label:d.toLocaleDateString(), value: sum}; }); const max = Math.max(1, ...arr.map(a=>a.value)); const w=240,h=60,gap=w/(arr.length-1||1); const path = arr.map((p,i)=>{ const x = i*gap; const y = h - (p.value/max)*(h-6) - 3; return `${i===0?'M':'L'} ${x.toFixed(2)} ${y.toFixed(2)}`; }).join(' ');
        return (<div><svg width={w} height={h}><path d={path} fill="none" stroke="#4f46e5" strokeWidth={2} strokeLinecap="round" strokeLinejoin="round"/> {arr.map((p,i)=>{ const x = i*gap; const y = h - (p.value/max)*(h-6) - 3; return <circle key={i} cx={x} cy={y} r={2.2} fill="#4f46e5" /> })}</svg></div>);
      }

      // --- Render app ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(React.createElement(PainelGestorDigital));
    </script>
  </body>
</html>
